<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DataTable</title>
    <!-- Enlace a Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <!-- DataTables CSS -->
    <link rel="stylesheet" href="https://cdn.datatables.net/2.2.2/css/dataTables.dataTables.min.css" />
    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"
        integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
    <!-- DataTables JS -->
    <script src="https://cdn.datatables.net/2.2.2/js/dataTables.min.js"></script>

    <script src="https://cdn.datatables.net/select/3.0.0/js/dataTables.select.min.js"
        integrity="sha384-Y/112jU1UJsyj7J/WhficUVfFZTLF2TgmBuDHBvJmYS8f+dGaz3ZNKxgwcg4YgP9"
        crossorigin="anonymous"></script>

    <!-- Incluir DataTables Column Reorder CSS y JS -->
    <link rel="stylesheet" href="https://cdn.datatables.net/colreorder/2.0.4/css/colReorder.dataTables.css">
    <script type="text/javascript" charset="utf8"
        src="https://cdn.datatables.net/colreorder/2.0.4/js/dataTables.colReorder.js"></script>

    <link rel="stylesheet" href="https://cdn.datatables.net/select/3.0.0/css/select.dataTables.css">
    <script type="text/javascript" charset="utf8"
        src="https://cdn.datatables.net/select/3.0.0/js/dataTables.select.js"></script>
    <script type="text/javascript" charset="utf8"
        src="https://cdn.datatables.net/select/3.0.0/js/select.dataTables.js"></script>

</head>

<body>
    <div class="container mt-5">

        <table id="xmlTable" class="order-column cell-border compact display" style="width:100%; display: none;">
            <thead>
                <tr id="tableHeaders">
                    <!-- Los encabezados se generarán dinámicamente -->
                </tr>
            </thead>
            <tbody id="tableBody">
                <!-- Aquí se llenarán las filas dinámicamente -->
            </tbody>
        </table>
    </div>

    <script>
        const isDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
        document.documentElement.setAttribute('data-bs-theme', isDark ? 'dark' : 'light');

        const headers = ['Nombre', 'Posición', 'Oficina', 'Edad', 'Opciones']; // Añadimos la columna 'Opciones'
        var data = [
            [
                "Tiger Nixon",
                "System Architect",
                "Edinburgh",
                "5421",
                "2011/04/25",
                "$3,120"
            ],
            [
                "Garrett Winters",
                "Director",
                "Edinburgh",
                "8422",
                "2011/07/25",
                "$5,300"
            ]
        ];

        const opciones = ['No aplica', 'Formatear', 'Homologar', 'Asignar valor por defecto'];

        // Crear las opciones del select para la última columna (Opciones)
        const crearSelect = () => {
            return opciones.map(opcion => `<option value="${opcion}">${opcion}</option>`).join('');
        };

        // Convertir los headers en objetos con título para DataTables
        const columnDefs = headers.map(title => ({ title }));

        $('#xmlTable').show();
        let table = new DataTable('#xmlTable', {
            colReorder: true,   // Activar reordenamiento de columnas
            select: {
                style: 'os',
                items: 'cell'
            },
            data: [], // empieza vacía
            columns: columnDefs,
            // Renderizamos la última columna con un select dinámico
            columnDefs: [{
                targets: 4, // La última columna (Opciones)
                render: function (data, type, row, meta) {
                    // Renderizamos un select en la última columna
                    return `<select>${crearSelect()}</select>`;
                }
            }],
        });

        table.rows.add(data).draw();
        table.clear().rows.add(data).draw();

        // Evitar que la selección de la fila se active cuando se hace clic en el select
        $('#xmlTable').on('click', 'select', function (event) {
            event.stopPropagation(); // Detenemos la propagación del evento de clic
        });

        table.on('buttons-action', function (e, buttonApi, dataTable, node, config) {
            console.log('Button ' + buttonApi.text() + ' was activated');
        });

        // Evento para capturar la selección de una celda
        $('#xmlTable').on('click', 'td', function () {
            const cell = table.cell(this); // Obtenemos la celda seleccionada
            const rowIndex = cell.index().row; // Índice de la fila
            const columnIndex = cell.index().column; // Índice de la columna
            console.log(`Fila: ${rowIndex}, Columna: ${columnIndex}`); // Mostramos la posición de la celda seleccionada
        });


    </script>
</body>

</html>